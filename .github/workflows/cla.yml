name: CLA Assistant

on:
  pull_request_target:
    types: [opened, synchronize, reopened, closed]
  issue_comment:
    types: [created]

permissions:
  contents: write
  pull-requests: write
  actions: read
  statuses: write

jobs:
  cla:
    runs-on: ubuntu-latest

    # Avoid jobs firing on random comments
    if: >
      github.event_name == 'pull_request_target' ||
      (
        github.event_name == 'issue_comment' &&
        contains(github.event.comment.body, 'recheck') ||
        contains(github.event.comment.body, 'hereby sign')
      )

    steps:
      - name: Run CLA Assistant
        uses: contributor-assistant/github-action@v2.3.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PERSONAL_ACCESS_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

        with:
          # Store signatures
          path-to-signatures: 'signatures/version1/cla.json'

          # Your agreement doc
          path-to-document: 'https://github.com/w3f/Grants-Program/blob/master/docs/Support%20Docs/T%26Cs.md'

          # Target branch â€” DO NOT USE protected branch
          branch: 'master'

          # People who don't need to sign anymore
          allowlist: |
            semuelle
            takahser
            Noc2
            PieWol
            keeganquigley
            laboon
            github-actions[bot]

          # Optional remote signatures repo
          remote-organization-name: 'w3f'
          remote-repository-name: 'grants-cla'

          # Messaging
          custom-notsigned-prcomment: >
            ðŸ‘‹ Thank you for your contribution.
            Before we can review, please sign our Contributor License Agreement.
            Add this exact line as a comment:
            **I have read and hereby sign the Contributor License Agreement.**

          custom-pr-sign-comment: >
            I have read and hereby sign the Contributor License Agreement.

          custom-allsigned-prcomment: >
            ðŸŸ¢ All required contributors have signed the CLA.
            Thank you for supporting the project.

          lock-pullrequest-aftermerge: false

          # DCO flag OFF (leave false unless project enforces)
          use-dco-flag: false
